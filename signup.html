<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ุฅูุดุงุก ุญุณุงุจ - ููุฑ ุงููุจูุฉ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-image: url('https://images.pexels.com/photos/7249294/pexels-photo-7249294.jpeg');
      background-size: cover;
      background-position: center;
    }
    .overlay {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(4px);
    }
    #global-loader {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255,255,255,0.85);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.4s;
    }
    #global-loader .spinner {
      border: 6px solid #eee;
      border-top: 6px solid #3498db;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
    .phone-input-container {
      display: flex;
      gap: 8px;
      align-items: stretch;
    }
    .country-code-select {
      width: 140px;
      flex-shrink: 0;
      border-radius: 6px 0 0 6px;
      border-right: none;
    }
    .phone-number-input {
      flex: 1;
      border-radius: 0 6px 6px 0;
      border-left: none;
    }
    .phone-input-container:focus-within {
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
      border-radius: 6px;
    }
    .phone-input-container:focus-within .country-code-select,
    .phone-input-container:focus-within .phone-number-input {
      border-color: #3b82f6;
      outline: none;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center">

  <div id="global-loader">
    <div class="spinner"></div>
  </div>

  <div class="overlay shadow-xl rounded-xl p-8 max-w-md w-full">
    <h2 class="text-3xl font-bold text-center text-blue-800 mb-6">โจ ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ โจ</h2>

    <form id="signupForm" class="space-y-4">
      <input type="text" name="fullname" placeholder="ุงูุงุณู ุงููุงูู" required class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"/>
      <input type="email" name="email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" required class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"/>
      
      <!-- ุฑูู ุงููุงุชู ูุน ููุชุงุญ ุงูุฏููุฉ -->
      <div class="phone-input-container">
        <select name="countryCode" required class="country-code-select px-4 py-2 border rounded-r-none focus:outline-none focus:ring-0 focus:border-blue-500">
          <option value="">๐ ููุชุงุญ ุงูุฏููุฉ</option>
          <option value="+966">๐ธ๐ฆ +966 (ุงูุณุนูุฏูุฉ)</option>
          <option value="+971">๐ฆ๐ช +971 (ุงูุฅูุงุฑุงุช)</option>
          <option value="+965">๐ฐ๐ผ +965 (ุงููููุช)</option>
          <option value="+973">๐ง๐ญ +973 (ุงูุจุญุฑูู)</option>
          <option value="+974">๐ถ๐ฆ +974 (ูุทุฑ)</option>
          <option value="+968">๐ด๐ฒ +968 (ุนูุงู)</option>
          <option value="+967">๐พ๐ช +967 (ุงูููู)</option>
          <option value="+962">๐ฏ๐ด +962 (ุงูุฃุฑุฏู)</option>
          <option value="+961">๐ฑ๐ง +961 (ูุจูุงู)</option>
          <option value="+963">๐ธ๐พ +963 (ุณูุฑูุง)</option>
          <option value="+964">๐ฎ๐ถ +964 (ุงูุนุฑุงู)</option>
          <option value="+20">๐ช๐ฌ +20 (ูุตุฑ)</option>
          <option value="+212">๐ฒ๐ฆ +212 (ุงููุบุฑุจ)</option>
          <option value="+213">๐ฉ๐ฟ +213 (ุงูุฌุฒุงุฆุฑ)</option>
          <option value="+216">๐น๐ณ +216 (ุชููุณ)</option>
          <option value="+218">๐ฑ๐พ +218 (ููุจูุง)</option>
          <option value="+249">๐ธ๐ฉ +249 (ุงูุณูุฏุงู)</option>
          <option value="+252">๐ธ๐ด +252 (ุงูุตููุงู)</option>
          <option value="+253">๐ฉ๐ฏ +253 (ุฌูุจูุชู)</option>
          <option value="+254">๐ฐ๐ช +254 (ููููุง)</option>
          <option value="+255">๐น๐ฟ +255 (ุชูุฒุงููุง)</option>
          <option value="+256">๐บ๐ฌ +256 (ุฃูุบูุฏุง)</option>
          <option value="+257">๐ง๐ฎ +257 (ุจูุฑููุฏู)</option>
          <option value="+258">๐ฒ๐ฟ +258 (ููุฒูุจูู)</option>
          <option value="+260">๐ฟ๐ฒ +260 (ุฒุงูุจูุง)</option>
          <option value="+261">๐ฒ๐ฌ +261 (ูุฏุบุดูุฑ)</option>
          <option value="+262">๐ท๐ช +262 (ุฑูููููู)</option>
          <option value="+263">๐ฟ๐ผ +263 (ุฒููุจุงุจูู)</option>
          <option value="+264">๐ณ๐ฆ +264 (ูุงููุจูุง)</option>
          <option value="+265">๐ฒ๐ผ +265 (ููุงูู)</option>
          <option value="+266">๐ฑ๐ธ +266 (ููุณูุชู)</option>
          <option value="+267">๐ง๐ผ +267 (ุจูุชุณูุงูุง)</option>
          <option value="+268">๐ธ๐ฟ +268 (ุฅุณูุงุชููู)</option>
          <option value="+269">๐ฐ๐ฒ +269 (ุฌุฒุฑ ุงูููุฑ)</option>
          <option value="+27">๐ฟ๐ฆ +27 (ุฌููุจ ุฃูุฑูููุง)</option>
          <option value="+290">๐ธ๐ญ +290 (ุณุงูุช ูููููุง)</option>
          <option value="+291">๐ช๐ท +291 (ุฅุฑูุชุฑูุง)</option>
          <option value="+297">๐ฆ๐ผ +297 (ุฃุฑูุจุง)</option>
          <option value="+298">๐ซ๐ด +298 (ุฌุฒุฑ ูุงุฑู)</option>
          <option value="+299">๐ฌ๐ฑ +299 (ุฌุฑูููุงูุฏ)</option>
          <option value="+30">๐ฌ๐ท +30 (ุงููููุงู)</option>
          <option value="+31">๐ณ๐ฑ +31 (ููููุฏุง)</option>
          <option value="+32">๐ง๐ช +32 (ุจูุฌููุง)</option>
          <option value="+33">๐ซ๐ท +33 (ูุฑูุณุง)</option>
          <option value="+34">๐ช๐ธ +34 (ุฅุณุจุงููุง)</option>
          <option value="+350">๐ฌ๐ฎ +350 (ุฌุจู ุทุงุฑู)</option>
          <option value="+351">๐ต๐น +351 (ุงูุจุฑุชุบุงู)</option>
          <option value="+352">๐ฑ๐บ +352 (ูููุณูุจูุฑุบ)</option>
          <option value="+353">๐ฎ๐ช +353 (ุฃูุฑููุฏุง)</option>
          <option value="+354">๐ฎ๐ธ +354 (ุขูุณููุฏุง)</option>
          <option value="+355">๐ฆ๐ฑ +355 (ุฃูุจุงููุง)</option>
          <option value="+356">๐ฒ๐น +356 (ูุงูุทุง)</option>
          <option value="+357">๐จ๐พ +357 (ูุจุฑุต)</option>
          <option value="+358">๐ซ๐ฎ +358 (ููููุฏุง)</option>
          <option value="+359">๐ง๐ฌ +359 (ุจูุบุงุฑูุง)</option>
          <option value="+36">๐ญ๐บ +36 (ุงููุฌุฑ)</option>
          <option value="+370">๐ฑ๐น +370 (ููุชูุงููุง)</option>
          <option value="+371">๐ฑ๐ป +371 (ูุงุชููุง)</option>
          <option value="+372">๐ช๐ช +372 (ุฅุณุชูููุง)</option>
          <option value="+373">๐ฒ๐ฉ +373 (ูููุฏููุง)</option>
          <option value="+374">๐ฆ๐ฒ +374 (ุฃุฑููููุง)</option>
          <option value="+375">๐ง๐พ +375 (ุจููุงุฑูุณูุง)</option>
          <option value="+376">๐ฆ๐ฉ +376 (ุฃูุฏูุฑุง)</option>
          <option value="+377">๐ฒ๐จ +377 (ูููุงูู)</option>
          <option value="+378">๐ธ๐ฒ +378 (ุณุงู ูุงุฑููู)</option>
          <option value="+380">๐บ๐ฆ +380 (ุฃููุฑุงููุง)</option>
          <option value="+381">๐ท๐ธ +381 (ุตุฑุจูุง)</option>
          <option value="+382">๐ฒ๐ช +382 (ุงูุฌุจู ุงูุฃุณูุฏ)</option>
          <option value="+385">๐ญ๐ท +385 (ูุฑูุงุชูุง)</option>
          <option value="+386">๐ธ๐ฎ +386 (ุณููููููุง)</option>
          <option value="+387">๐ง๐ฆ +387 (ุงูุจูุณูุฉ ูุงููุฑุณู)</option>
          <option value="+389">๐ฒ๐ฐ +389 (ููุฏูููุง ุงูุดูุงููุฉ)</option>
          <option value="+39">๐ฎ๐น +39 (ุฅูุทุงููุง)</option>
          <option value="+40">๐ท๐ด +40 (ุฑููุงููุง)</option>
          <option value="+41">๐จ๐ญ +41 (ุณููุณุฑุง)</option>
          <option value="+420">๐จ๐ฟ +420 (ุฌูููุฑูุฉ ุงูุชุดูู)</option>
          <option value="+421">๐ธ๐ฐ +421 (ุณูููุงููุง)</option>
          <option value="+423">๐ฑ๐ฎ +423 (ููุฎุชูุดุชุงูู)</option>
          <option value="+43">๐ฆ๐น +43 (ุงูููุณุง)</option>
          <option value="+44">๐ฌ๐ง +44 (ุงูููููุฉ ุงููุชุญุฏุฉ)</option>
          <option value="+45">๐ฉ๐ฐ +45 (ุงูุฏููุงุฑู)</option>
          <option value="+46">๐ธ๐ช +46 (ุงูุณููุฏ)</option>
          <option value="+47">๐ณ๐ด +47 (ุงููุฑููุฌ)</option>
          <option value="+48">๐ต๐ฑ +48 (ุจูููุฏุง)</option>
          <option value="+49">๐ฉ๐ช +49 (ุฃููุงููุง)</option>
          <option value="+1">๐บ๐ธ +1 (ุงูููุงูุงุช ุงููุชุญุฏุฉ)</option>
          <option value="+1">๐จ๐ฆ +1 (ููุฏุง)</option>
          <option value="+52">๐ฒ๐ฝ +52 (ุงูููุณูู)</option>
          <option value="+54">๐ฆ๐ท +54 (ุงูุฃุฑุฌูุชูู)</option>
          <option value="+55">๐ง๐ท +55 (ุงูุจุฑุงุฒูู)</option>
          <option value="+56">๐จ๐ฑ +56 (ุชุดููู)</option>
          <option value="+57">๐จ๐ด +57 (ูููููุจูุง)</option>
          <option value="+58">๐ป๐ช +58 (ููุฒูููุง)</option>
          <option value="+591">๐ง๐ด +591 (ุจูููููุง)</option>
          <option value="+593">๐ช๐จ +593 (ุงูุฅููุงุฏูุฑ)</option>
          <option value="+594">๐ฌ๐ซ +594 (ุบููุงูุง ุงููุฑูุณูุฉ)</option>
          <option value="+595">๐ต๐พ +595 (ุจุงุฑุงุบูุงู)</option>
          <option value="+596">๐ฒ๐ถ +596 (ูุงุฑุชูููู)</option>
          <option value="+597">๐ธ๐ท +597 (ุณูุฑููุงู)</option>
          <option value="+598">๐บ๐พ +598 (ุงูุฃูุฑูุบูุงู)</option>
          <option value="+599">๐ง๐ถ +599 (ุจูููุฑ)</option>
          <option value="+60">๐ฒ๐พ +60 (ูุงููุฒูุง)</option>
          <option value="+61">๐ฆ๐บ +61 (ุฃุณุชุฑุงููุง)</option>
          <option value="+62">๐ฎ๐ฉ +62 (ุฅูุฏูููุณูุง)</option>
          <option value="+63">๐ต๐ญ +63 (ุงูููุจูู)</option>
          <option value="+64">๐ณ๐ฟ +64 (ูููุฒูููุฏุง)</option>
          <option value="+65">๐ธ๐ฌ +65 (ุณูุบุงููุฑุฉ)</option>
          <option value="+66">๐น๐ญ +66 (ุชุงููุงูุฏ)</option>
          <option value="+81">๐ฏ๐ต +81 (ุงููุงุจุงู)</option>
          <option value="+82">๐ฐ๐ท +82 (ููุฑูุง ุงูุฌููุจูุฉ)</option>
          <option value="+84">๐ป๐ณ +84 (ููุชูุงู)</option>
          <option value="+86">๐จ๐ณ +86 (ุงูุตูู)</option>
          <option value="+91">๐ฎ๐ณ +91 (ุงูููุฏ)</option>
          <option value="+92">๐ต๐ฐ +92 (ุจุงูุณุชุงู)</option>
          <option value="+93">๐ฆ๐ซ +93 (ุฃูุบุงูุณุชุงู)</option>
          <option value="+94">๐ฑ๐ฐ +94 (ุณุฑููุงููุง)</option>
          <option value="+95">๐ฒ๐ฒ +95 (ููุงููุงุฑ)</option>
          <option value="+98">๐ฎ๐ท +98 (ุฅูุฑุงู)</option>
          <option value="+880">๐ง๐ฉ +880 (ุจูุบูุงุฏูุด)</option>
          <option value="+977">๐ณ๐ต +977 (ููุจุงู)</option>
          <option value="+994">๐ฆ๐ฟ +994 (ุฃุฐุฑุจูุฌุงู)</option>
          <option value="+995">๐ฌ๐ช +995 (ุฌูุฑุฌูุง)</option>
          <option value="+996">๐ฐ๐ฌ +996 (ููุฑุบูุฒุณุชุงู)</option>
          <option value="+998">๐บ๐ฟ +998 (ุฃูุฒุจูุณุชุงู)</option>
        </select>
        <input type="tel" name="phoneNumber" placeholder="๐ฑ ุฑูู ุงููุงุชู" required class="phone-number-input px-4 py-2 border rounded-l-none focus:outline-none focus:ring-0 focus:border-blue-500"/>
      </div>
      
      <!-- ุงูููุน -->
      <select name="gender" required class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">ุงุฎุชุฑ ุงูููุน</option>
        <option value="ุฐูุฑ">ุฐูุฑ</option>
        <option value="ุฃูุซู">ุฃูุซู</option>
        <option value="ูุฎุตุต">ูุฎุตุต</option>
      </select>
      
      <!-- ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ -->
      <select name="grade" required class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">ุงุฎุชุฑ ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ</option>
        <option value="ุงุจุชุฏุงุฆู">ุงุจุชุฏุงุฆู</option>
        <option value="ุฅุนุฏุงุฏู">ุฅุนุฏุงุฏู</option>
        <option value="ุซุงููู">ุซุงููู</option>
        <option value="ุฌุงูุนู">ุฌุงูุนู</option>
        <option value="ุฎุฑูุฌ">ุฎุฑูุฌ</option>
      </select>
      
      <input type="text" name="city" placeholder="ุงููุฏููุฉ" class="w-full px-4 py-2 border rounded"/>
      <input type="text" name="parentPhone" placeholder="ุฑูู ููู ุงูุฃูุฑ (ุงุฎุชูุงุฑู)" class="w-full px-4 py-2 border rounded"/>
      <input type="password" name="password" placeholder="ูููุฉ ุงููุฑูุฑ" required class="w-full px-4 py-2 border rounded"/>

      <button type="submit" class="w-full bg-blue-700 text-white py-2 rounded hover:bg-blue-800 transition">๐ ุฅูุดุงุก ุงูุญุณุงุจ</button>
    </form>

    <p class="text-center text-sm mt-4">
      ูุฏูู ุญุณุงุจ ุจุงููุนูุ
      <a id="loginLink" href="login.html" class="text-blue-600 hover:underline">ุชุณุฌูู ุงูุฏุฎูู</a>
    </p>

    <div id="message" class="mt-4 text-center text-sm font-semibold"></div>
  </div>

  <script>
    const redirectTo = new URLSearchParams(window.location.search).get("next") || "home.html";
    document.getElementById("loginLink").href = `login.html?next=${encodeURIComponent(redirectTo)}`;

    const form = document.getElementById("signupForm");
    const messageDiv = document.getElementById("message");
    const countryCodeSelect = document.querySelector('select[name="countryCode"]');
    const phoneNumberInput = document.querySelector('input[name="phoneNumber"]');

    // ุฅุถุงูุฉ ูุณุชูุน ุญุฏุซ ูุชุบููุฑ ููุชุงุญ ุงูุฏููุฉ
    countryCodeSelect.addEventListener('change', function() {
      if (this.value) {
        // ุงูุชุฑููุฒ ุงูุชููุงุฆู ุนูู ุญูู ุฑูู ุงููุงุชู
        phoneNumberInput.focus();
        
        // ุฅุถุงูุฉ ุชุฃุซูุฑ ุจุตุฑู ูุญูู ุฑูู ุงููุงุชู
        phoneNumberInput.classList.add('ring-2', 'ring-blue-500', 'border-blue-500');
        
        // ุฅุฒุงูุฉ ุงูุชุฃุซูุฑ ุจุนุฏ ุซุงููุชูู
        setTimeout(() => {
          phoneNumberInput.classList.remove('ring-2', 'ring-blue-500', 'border-blue-500');
        }, 2000);
      }
    });

    // ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุนูุฏ ุงููุชุงุจุฉ ูู ุญูู ุฑูู ุงููุงุชู
    phoneNumberInput.addEventListener('input', function() {
      // ุฅุฒุงูุฉ ุฃู ุฃุญุฑู ุบูุฑ ุฑูููุฉ
      this.value = this.value.replace(/[^0-9]/g, '');
      
      // ุชุญุฏูุฏ ุงูุญุฏ ุงูุฃูุตู ูุทูู ุงูุฑูู (15 ุฑูู)
      if (this.value.length > 15) {
        this.value = this.value.slice(0, 15);
      }
    });

    // ุฅุถุงูุฉ ุชุญูู ูู ููุชุงุญ ุงูุฏููุฉ ุนูุฏ ูุญุงููุฉ ุงููุชุงุจุฉ ูู ุฑูู ุงููุงุชู
    phoneNumberInput.addEventListener('focus', function() {
      if (!countryCodeSelect.value) {
        // ุฅุธูุงุฑ ุชูุจูู ูููุณุชุฎุฏู
        messageDiv.textContent = "โ๏ธ ูุฑุฌู ุงุฎุชูุงุฑ ููุชุงุญ ุงูุฏููุฉ ุฃููุงู";
        messageDiv.classList.remove('text-green-600', 'text-red-600');
        messageDiv.classList.add('text-yellow-600');
        
        // ุฅุฒุงูุฉ ุงูุชูุจูู ุจุนุฏ 3 ุซูุงู
        setTimeout(() => {
          messageDiv.textContent = "";
          messageDiv.classList.remove('text-yellow-600');
        }, 3000);
        
        // ุงูุชุฑููุฒ ุนูู ูุงุฆูุฉ ููุชุงุญ ุงูุฏููุฉ
        countryCodeSelect.focus();
      }
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // ุงูุชุญูู ูู ุงุฎุชูุงุฑ ููุชุงุญ ุงูุฏููุฉ
      if (!countryCodeSelect.value) {
        messageDiv.textContent = "โ ูุฑุฌู ุงุฎุชูุงุฑ ููุชุงุญ ุงูุฏููุฉ";
        messageDiv.classList.remove('text-green-600', 'text-yellow-600');
        messageDiv.classList.add('text-red-600');
        countryCodeSelect.focus();
        return;
      }

      // ุงูุชุญูู ูู ุฅุฏุฎุงู ุฑูู ุงููุงุชู
      if (!phoneNumberInput.value.trim()) {
        messageDiv.textContent = "โ ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงููุงุชู";
        messageDiv.classList.remove('text-green-600', 'text-yellow-600');
        messageDiv.classList.add('text-red-600');
        phoneNumberInput.focus();
        return;
      }

      // Disable the submit button to prevent multiple submissions
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = "ุฌุงุฑู ุฅูุดุงุก ุงูุญุณุงุจ...";

      const formData = new FormData(form);
      const countryCode = formData.get("countryCode");
      const phoneNumber = formData.get("phoneNumber");
      const fullPhoneNumber = countryCode + phoneNumber;

      const params = new URLSearchParams({
        action: "addStudent",
        "ุงูุงุณู ุงููุงูู": formData.get("fullname"),
        "ุงูุจุฑูุฏ ุงูุฅููุชุฑููู": formData.get("email"),
        "ุฑูู ุงูุทุงูุจ": fullPhoneNumber,
        "ุงูููุน": formData.get("gender"),
        "ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ": formData.get("grade"),
        "ุงููุฏููุฉ": formData.get("city"),
        "ุฑูู ููู ุงูุฃูุฑ": formData.get("parentPhone") || "",
        "ูููุฉ ุงููุฑูุฑ": formData.get("password")
      });

      try {
        const res = await fetch(
          "https://script.google.com/macros/s/AKfycbzYsZh3bYhjznpFCxAqDUTeSggfJiegyCSw2sJPB_Cf1OTO7VnFSHeI7mPygd-QQ_wn/exec?" + params.toString(),
          { method: "POST" }
        );
        const text = await res.text();

        messageDiv.textContent = "โ " + text;
        messageDiv.classList.remove('text-red-600', 'text-yellow-600');
        messageDiv.classList.add("text-green-600");
        form.reset();

        // ุชูุฌูู ุฅูู ุชุณุฌูู ุงูุฏุฎูู ูุน ุงูุงุญุชูุงุธ ุจุงูุตูุญุฉ ุงูุฃุตููุฉ
        setTimeout(() => {
          window.location.href = `login.html?next=${encodeURIComponent(redirectTo)}`;
        }, 1500);
      } catch (err) {
        messageDiv.textContent = "โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจุงูุฎุงุฏู.";
        messageDiv.classList.remove('text-green-600', 'text-yellow-600');
        messageDiv.classList.add("text-red-600");
      } finally {
        // ุฅุนุงุฏุฉ ุชูุนูู ุงูุฒุฑ
        submitBtn.disabled = false;
        submitBtn.textContent = "๐ ุฅูุดุงุก ุงูุญุณุงุจ";
      }
    });

    window.addEventListener('load', function() {
      const loader = document.getElementById('global-loader');
      if(loader) {
        // ุฅุฎูุงุก ุงูููุฏูุฌ ููุฑุงู ุจุนุฏ ุชุญููู ุงูุตูุญุฉ
        loader.style.opacity = '0';
        setTimeout(() => loader.style.display = 'none', 400);
      }
    });
  </script>
</body>
</html> 